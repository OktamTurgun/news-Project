{% extends 'news/base.html' %}
{% load static %}

{% block title %}Admin Panel{% endblock title %}

{% block content %}
<div class="container mt-5">
  <div class="row mb-4">
    <div class="col-xs-6">
      <h2>ðŸ“Š Admin sahifasi</h2>
    </div>
    <div class="col-xs-6 text-right">
      <a href="{% url 'news:news_create' %}" class="btn btn-success">+ Yangilik qo'shish</a>
    </div>
  </div>

  <!-- Statistikalar -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm border-primary text-center">
        <div class="card-body">
          <h5 class="card-title">ðŸ‘¥ Foydalanuvchilar soni</h5>
          <p class="display-6">{{ users_count }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm border-success text-center">
        <div class="card-body">
          <h5 class="card-title">ðŸ“° Yangiliklar soni</h5>
          <p class="display-6">{{ news_count }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Soâ€˜nggi ma'lumotlar -->
  <div class="row mb-5">
    <!-- Soâ€˜nggi foydalanuvchilar -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">Soâ€˜nggi 5 foydalanuvchi</div>
        <ul class="list-group list-group-flush">
          {% for user in last_users %}
          <li class="list-group-item">
            <strong>{{ user.first_name }} {{ user.last_name }}</strong> 
            <small class="text-muted">(@{{ user.username }})</small><br>
            <span class="text-muted">{{ user.email }}</span><br>
            <small class="text-muted">Qoâ€˜shilgan: {{ user.date_joined|date:"d.m.Y H:i" }}</small><br>
            <small class="text-muted">Oxirgi login: {{ user.last_login|date:"d.m.Y H:i" }}</small><br>

            <!-- Role -->
            {% if user.is_superuser %}
              <span class="badge bg-danger">Superuser</span>
            {% elif user.is_staff %}
              <span class="badge bg-info">Admin</span>
            {% else %}
              <span class="badge bg-secondary">User</span>
            {% endif %}
            
            <!-- Status -->
            {% if user.is_active %}
              <span class="text-success">Active</span>
            {% else %}
              <span class="text-danger">Inactive</span>
            {% endif %}
          </li>
          {% empty %}
          <li class="list-group-item">Hech qanday foydalanuvchi yoâ€˜q</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <!-- Soâ€˜nggi yangiliklar -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-success text-white">Soâ€˜nggi 5 yangilik</div>
        <ul class="list-group list-group-flush">
          {% for news in last_news %}
          <li class="list-group-item">
            <div class="row">
              {% if news.image %}
                <div class="col-xs-3">
                  <img src="{{ news.image.url }}" alt="{{ news.title }}" 
                      class="img-thumbnail" style="width: 60px; height: 40px; object-fit: cover;">
                </div>
              {% endif %}
              <div class="col-xs-7">
                <a href="{% url 'news:news_detail' news.slug %}">{{ news.title }}</a>
                <p class="mb-0 small text-muted">
                  {{ news.created_at|date:"d.m.Y H:i" }} | by {{ news.author.username }}
                </p>
              </div>
              <div class="col-xs-2 text-right">
                {% if news.category %}
                  <span class="badge">{{ news.category.name }}</span>
                {% endif %}
              </div>
            </div>
          </li>
          {% empty %}
          <li class="list-group-item">Hozircha yangiliklar yoâ€˜q</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    
    <!-- Adminlar statistikasi -->
    <div class="row bottom-space">
      <div class="col-md-6">
        <div class="panel panel-default text-center">
          <div class="panel-heading">ðŸ‘‘ Adminlar soni</div>
          <div class="panel-body">
            <p class="lead">{{ admin_users.count }}</p>
          </div>
        </div>
      </div>

      <!-- Adminlar ro'yxati -->
      <div class="col-md-6">
        <div class="panel panel-default">
          <div class="panel-heading bg-dark text-white">ðŸ‘‘ Adminlar</div>
          <ul class="list-group">
            {% for admin in admin_users %}
            <li class="list-group-item clearfix">
              <span>{{ admin.username }}</span>
              <small class="pull-right text-muted">
                {% if admin.is_superuser %}Superuser{% else %}Staff{% endif %}
              </small>
            </li>
            {% empty %}
            <li class="list-group-item">Adminlar mavjud emas</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>


  <!-- Tafsilotlar qismi -->
  <div class="row">
    <!-- Foydalanuvchilar tafsilotlari -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">ðŸ‘¥ Foydalanuvchilar tafsilotlari</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for user in last_users %}
              <li class="list-group-item">
                <div class="row">
                  <div class="col-xs-9">
                    <strong>{{ user.first_name }} {{ user.last_name }}</strong>
                    <small class="text-muted">(@{{ user.username }})</small><br>
                    <span class="text-muted">{{ user.email }}</span>
                  </div>
                  <div class="col-xs-3 text-right">
                    {% if user.is_superuser %}
                      <span class="role-badge super">Superuser</span>
                    {% elif user.is_staff %}
                      <span class="role-badge admin">Admin</span>
                    {% else %}
                      <span class="role-badge user">User</span>
                    {% endif %}
                  </div>
                </div>
              </li>
            {% empty %}
              <li class="list-group-item">Hech qanday foydalanuvchi topilmadi</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Yangiliklar tafsilotlari -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">ðŸ“° Yangiliklar tafsilotlari</h5>
        </div>
        <div class="card-body">
          <ul class="list-group">
            {% for news_item in last_news %}
              <li class="list-group-item">
                <strong>{{ news_item.title }}</strong><br>
                <small class="text-muted">
                  {{ news_item.created_at|date:"d M Y H:i" }}  
                  â€” {{ news_item.author.get_full_name|default:news_item.author.username }}
                </small>
              </li>
            {% empty %}
              <li class="list-group-item">Hozircha yangilik qoâ€˜shilmagan</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock content %}

